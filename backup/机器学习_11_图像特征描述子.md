# 图像特征描述子 - HOG与SIFT特征
## HOG特征
### 基本原理
1. **图像梯度计算**
    - 图像 \(f(x, y)\) 在点 \((x, y)\) 的梯度是矢量，\(x\)方向梯度 \(g_{x}=\frac{\partial f}{\partial x}=f(x + 1, y) - f(x, y)\)，\(y\) 方向梯度\(g_{y}=\frac{\partial f}{\partial y}=f(x, y + 1) - f(x, y)\)，梯度强度\(g = \sqrt{g_{x}^{2}+g_{y}^{2}}\)，梯度方向\(\theta = arctan\frac{g_{x}}{g_{y}}\)。
    - 当图像存在边缘时，梯度值较大；平滑部分灰度值变化小，梯度也小。\(x\)方向梯度强化垂直方向特征，\(y\)方向梯度强化水平方向特征。
2. **HOG特征本质**
    - HOG（Histogram of Oriented Gradient）是方向梯度直方图，是CV领域用于物体检测的特征描述子，本质是梯度的统计信息，能反映局部图像的边缘、形状等。由Dalal在CVPR 2005首次提出用于行人检测。

### 提取步骤
1. **图像预处理**
    - 检查窗口大小根据应用场景选取（如\(64×128\)），进行Gamma校正（调节图像对比度，减少光照不均和局部阴影，矫正过曝或曝光不足，\(\gamma = 0.67\)时扩展高光压缩暗调，\(\gamma = 1.5\)时相反）和灰度化。
2. **计算图像梯度**
    - 计算水平和垂直方向梯度强度与方向（梯度图移除非显著性特征，加强显著特征，三通道彩色图取梯度强度最大通道的强度和对应方向）。
3. **计算梯度直方图**
    - 以\(cell\)（如\(8×8\)）为单位计算梯度直方图，每\(20°\)为一个单元，统计\(0 - 180°\)的梯度方向，得到\(9\)个值。根据梯度方向和强度更新直方图，如梯度方向\(80°\)强度\(2\)，则\(80°\)对应值加\(2\)；方向\(10°\)强度\(4\)，\(0°\)和\(20°\)对应值各加\(2\)；方向\(165°\)强度\(85\)，\(0°\)和\(160°\)的值分别加\(21.25\)和\(63.75\)（认为\(0°\)和\(180°\)等价）。优点是降低计算量且对光照环境变化鲁棒。
4. **归一化**
    - 以\(block\)（如\(16×16\)，\(1\)个\(block = 4\)个\(cell\)）为单位进行归一化，方法是向量每个值除以向量的模（如\((128, 64, 32)\)归一化后为\((0.87, 0.43, 0.22)\)），使特征描述子不受光照变化影响。
5. **组合成HOG特征向量**
    - 将所有\(block\)的归一化梯度直方图组合成HOG特征向量，维度为\(36×105 = 3780\)（\(64×128\)大小图像，\(7×15 = 105\)个\(block\)，每个\(block\)有\(36\)个特征）。梯度直方图主导方向捕捉人的形状（如躯干和腿部）。

### 特征特性
- HOG特征描述子通过统计图像局部区域梯度方向信息表征局部图像区域，类似SIFT特征描述子。但HOG不选取主方向，无旋转梯度方向直方图，本身不具旋转不变性（通过不同旋转方向训练样本实现）和尺度不变性（通过改变检测图像大小实现）。

## SIFT特征
### 基本原理
1. **SIFT定义与特性**
    - SIFT（Scale Invariant Feature Transform）即尺度不变特征转换，用于图像处理，具有尺度不变性，对物体尺度变化、刚体变换、光照强度和遮挡有较好稳定性，可检测关键点，是局部特征描述算子。由British Columbia大学大卫·劳伊（David G. Lowe）教授提出并完善。
2. **解决问题与应用**
    - 解决目标在不同状态（旋转、缩放、平移、遮挡等）和环境（光照、仿射/投影变换、杂物场景、噪声等）下的图像配准/目标识别跟踪问题，应用于全景图像拼接、物体识别、三维重建等。
3. **特征匹配流程**
    - 包含找出显著特征点（Feature Detect）、描述特征点（Feature Descriptor）、比较描述相似程度判断是否为同一特征（Feature Match）三步，是计算机视觉应用（如图像配准、摄像机跟踪、三维重建、物体识别、人脸识别）的基础。

### 算法实现细节
1. **构建尺度空间**
    - 尺度空间\(L(x, y, \sigma)=G(x, y, \sigma) * I(x, y)\)（\(G(x, y, \sigma)=\frac{1}{2\pi\sigma^{2}} exp(-\frac{(x - x_{i})^{2}+(y - y_{i})^{2}}{2\sigma^{2}})\)），\(\sigma\)越小图像越清晰，反之越模糊。早期多尺度用高斯金字塔表述，构建分两步：对图像高斯平滑/模糊，再降采样得到尺寸缩小图像，降采样基础上加高斯滤波体现尺度连续性。一组图像（octave）包括多层（interval）图像。
    - 传统SIFT通过高斯差分尺度空间（DOG）提取特征点，DOG函数\(D(x, y, \sigma)=L(x, y, k\sigma)-L(x, y, \sigma)\)，计算效率高，是尺度归一化LoG的近似，尺度稳定性好。DOG尺度空间通过相邻尺度高斯平滑后图像相减得到。
2. **特征点定位**
    - 特征点是不同尺度空间图像下具方向信息的局部极值点，具有尺度、方向、大小特征。先在DOG尺度空间通过点与同尺度\(8\)个相邻点及上下相邻尺度\(9×2\)个点共\(26\)个点比较检测极值点（一个点在DOG尺度空间的\(26\)个邻域中是最大或最小值时为特征点），再通过曲线拟合DOG函数精确定位（求导令为\(0\)得到精确位置偏移量，若偏移量大于\(0.5\)更换特征点重复流程），最后去除不稳定特征点（将精度点值代入泰勒展开式，\(|D(\hat{X})| ≥ 0.03\)保留，否则丢弃；去除DoG算子产生的边缘响应点，通过\(2×2\)的Hessian矩阵\(H\)判断，\(\frac{Tr^{2}(H)}{Det(H)}=\frac{(\lambda_{1} / \lambda_{2}+1)^{2}}{\lambda_{1} / \lambda_{2}} ≤\frac{(10 + 1)^{2}}{10}\)保留，否则丢弃）。
3. **特征点主方向确定**
    - 计算以特征点为中心的邻域（窗口）内像素梯度方向和幅值，统计梯度方向直方图确定主方向（峰值方向），特殊情况（如最大峰值小于\(80\%\)第二峰值）时可能有多个主方向或需进一步处理。
4. **特征描述**
    - 以特征点为中心根据主方向取\(4\)个\(4×4\)窗口，对梯度幅值图高斯平滑，在每个\(4×4\)子区域绘制\(8\)个方向的梯度幅值加权直方图形成种子点，实际应用中为增强匹配稳健性，用\(16\)个种子点描述，得到\(4×4×8 = 128\)维SIFT特征向量。
5. **特征匹配**
    - 基本假设是通过特征描述子间欧式距离判断匹配程度，距离越小匹配度越高。基本思路是距离小于阈值则匹配成功，常用距离度量函数有固定阈值、最近邻、最近邻比值法（距离最近和次近特征点距离比值小于阈值时，将最近点作为匹配点）。

### 算法扩展与改进
- SIFT算法存在实时性不高、特征点少、对边缘模糊目标提取特征点不准确等缺陷，后续有PCA - SIFT（利用主成分分析降维化简SIFT算子描述子）、CSIFT（针对彩色图像提取不变特征）、SURF（计算量小、速度快，特征点与SIFT几乎相同）等改进算法。SIFT、PCA - SIFT与SURF在时间、尺度、旋转、模糊、光照、仿射等方面性能各有优劣。